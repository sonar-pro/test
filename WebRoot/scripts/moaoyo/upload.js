var uploadData={};(function(c){if(typeof c.mk=="undefined"){c.mk={}}if(typeof c.mk.upload=="undefined"){c.mk.upload={}}c.mk.upload.delFile=function(e,d){var f=e.id.split("_")[1];c("#tr_"+f).remove();c("#fileCount").text(parseInt(c("#fileCount").text())-1);c("#sizeCount").text(parseInt(c("#sizeCount").text())-d);c("tr[name='picTr']").each(function(g){this.id="tr_"+g;c(this).find("div[name='progressDiv']").attr("id","progress_"+g);c(this).find("span[name='progress_span']").attr("id","span_pro_"+g);c(this).find("img").attr("id","a_"+g)});c("#FileUpload").get(0).delFile(f)};c.mk.upload.uploadFile=function(){if(c("tr[name='picTr']").size()==0){alert("请选择图片!");return}c("#loadImgBtn").attr("disabled",true);c("#FileUpload").get(0).flexUploadFile()};c.mk.upload.uploadProgress=function(d,e){c("#curFileCount").html(parseInt(d)+1);if(e!="已完成"){c("#progress_"+d).css("width",e)}c("#span_pro_"+d).html(e)};c.mk.upload.swfLoadSuccess=function(){c("#swfLoading").hide()};c.mk.upload.batchUpload=function(){var l="";var j="";c.ajax({url:"/commonAction|getUploadUrl.action",type:"get",dataType:"jsonp",async:false,success:function(m){if(m=="dataErr"||m==""){alert("数据错误,请刷新页面重新操作！");_setUploadButton(false);return}else{c("#webServerName").val(m.webserver);c("#uploadServerName").val(m.uploadserver);c("#uploadToken").val(m.upKey);l=m.uploadserver+"/flexUploadServlet";j=m.upKey}}});var d=c("#curImgId").val();var e=c("#uploadDomain").val();var g=c("#imgDomain").val();var h=c("#fileSize").val();var k=c("#flexFileCount").val();var i=c("#imgType").val();c("tr[name='picTr']").remove();c("#fileCount").text("0");c("#sizeCount").text("0");c("#commonDiv").hide();c("#batchDiv").show();c("#swfLoading").show();var f=new SWFObject(g+"/flash/FileUpload.swf?id=10","FileUpload","60","28","9","#FFFFFF");f.addParam("allowScriptAccess","always");f.addParam("wmode","transparent");f.addVariable("uploadUrl",l);f.addVariable("maxFileSize",h);f.addVariable("maxFileCount",k);f.addVariable("imageType",i);f.addVariable("delFile_jsFunction","delFile");f.addVariable("uploadFile_jsFunction","flexUploadFile");f.addVariable("addFile_jsFunction","addFileToItem");f.addVariable("browseFile_cbFunction","jQuery1.mk.module.loadFiles");f.addVariable("progressBar_cbFunction","jQuery1.mk.upload.uploadProgress");f.addVariable("uploadSuccess_cbFunction",flexUploadCallBack);f.addVariable("swfLoadedCom_cbFunction","jQuery1.mk.upload.swfLoadSuccess");f.addVariable("browerImgUrl",g+"/images/flexBrower.jpg");f.addVariable("upKey",j);f.write("swfDiv")};c.mk.upload.commonUpload=function(){c("#batchDiv").hide();c("#commonDiv").show()};var b=null;var a=0;c.mk.upload.getUploadStatus=function(e,i,g,j){var h=0;var d=false;c("#"+g).find('input[type="file"]').each(function(){if(c(this).val()!=""){h++}else{d=true}});if(d||h==0){alert("请上传图片!!!");return false}_setUploadButton(true);if(c("#divSubmitCardInfo").size()!=0){c("#divSubmitCardInfo").show()}a=0;var f="/commonAction|getUploadUrl.action";if(c("#hid_mokoadmin_domain").size()>0){f=c("#hid_mokoadmin_domain").val()+f}var k="";c.ajax({url:f,type:"get",dataType:"jsonp",async:false,success:function(m){if(m=="dataErr"||m==""){alert("数据错误,请刷新页面重新操作！");_setUploadButton(false);return}else{var l=m.webserver;var p=m.uploadserver;var n=m.upKey;var o=m.uploadurl;c.ajax({url:o,type:"get",dataType:"jsonp",async:false,success:function(q){c("#webServerName").val(l);c("#uploadServerName").val(p);c("#uploadToken").val(n);c("#"+j).attr("action",o);c("#"+j).submit();c("#"+e).show();c("#"+e).html("");setTimeout(function(){_showUploadStatus(o,e,i)},2000)}})}}});return true};c.mk.upload.cancelUpload=function(d){if(b!=null){clearTimeout(b)}var e="/commonAction|cancelUpload.action?upkey="+c("#uploadToken").val();if(c("#hid_mokoadmin_domain").size()>0){e=c("#hid_mokoadmin_domain").val()+e}c.ajax({url:e,type:"post",async:false,success:function(f){}});c.mokoDialog.close(d)};c.mk.upload.showUploadErrMsg=function(d){if(d!=null&&d.length>0){alert(d)}};c.mk.upload.loadPicItme=function(e,f){var g=e.pic.length;if(g<1){c("#status").hide();c.mokoDialog.close();return}var d=g;c.mk.upload.loadNextPic=function(){if(--d<0){return}var h={yuantu:e.pic[d].yuantu,visitPath:e.pic[d].visitPath};jQuery1.mk.module.loadImage(h)};c.mk.upload.loadNextPic();c.mokoDialog.close()};_showUploadPicData=function(d,f){try{if(d.code=="1"&&d.pic.length>0){_showPicByType(d,f)}else{if(d.code=="102"){alert("上传图片超过5M限制！")}else{if(d.code=="103"){alert("上传总大小超过限制！")}else{alert("上传出错！")}}}}catch(g){alert("上传出错！")}finally{_setUploadButton(false)}};_showPicByType=function(d,e){if(e=="post_cover"){c.mk.post.showPostCoverPic(d)}else{if(e=="post_item"){c.mk.post.showPostItemPic(d)}else{if(e=="project_cover"){c.mk.project.showProjectMokoShowPic(d)}else{if(e=="user_card"){c.mk.mymoko.showUserCardPic(d)}else{if(e=="user_apply"){c.mk.mymoko.showUserApplyPic(d)}else{if(e=="user_header"){c.mk.mymoko.showUserLogo(d)}else{if(e=="face_senior_dynamic"){c.mk.face.showFaceUploadPic(d)}else{if(e=="face_simple"){c.mk.face.showFaceSimplePic(d)}else{if(e=="user_mip"){c.mk.mymoko.showUserMipPic(d)}else{if(e=="blog_pic"){c.mk.blog.showBlogPic(d)}else{if(e=="background_pic"){c.mk.mymoko.showUserBackground(d)}else{if(e=="cpgroup"){c.mk.company.showCpGroupPic(d)}else{if(e=="guanggaopic"){c.mk.guanggao.showGuanggaoPic(d)}else{if(e=="mspapply"){c.mk.msp.setPhoto(d)}else{if(e=="mtg_cover"){c.mk.mtgmanage.showMtgCover(d)}else{if(e=="mtg_item"){c.mk.mtgmanage.showMtgItem(d)}else{if(e=="mtg_shangpin"){c.mk.mtgmanage.showMtgShangpin(d)}}}}}}}}}}}}}}}}}};_showUploadStatus=function(e,d,f){c.ajax({url:e,type:"get",dataType:"jsonp",success:function(i){try{if(i!=null&&i!=""&&i!="null"){var m=i.bytesRead;var h=i.totalSize;var k=i.fileLength;if(h>0&&m>0){var j=Math.ceil((m/h)*100);var g='<div class="uping"><div class="borderOn"><div class="bg" style="width:'+j+'%;"></div></div><span class="font12">总大小:'+k+"("+j+"%)</span></div>";if(f=="blog_pic"||f=="user_header"||f=="background_pic"||f=="mspapply"){g='<div class="uping"><div class="bd"><div class="bg mBC" style="width:'+j+'%;"></div></div><span class="f12">总大小:'+k+"("+j+"%)</span></div>"}else{if(f=="cpgroup"||f=="guanggaopic"){g=j+"%"}}c("#"+d).html(g)}if(i.code=="2"){b=setTimeout(function(){_showUploadStatus(e,d,f)},1000);return}else{clearTimeout(b);uploadData.pic=i.pic;var g='<div class="uping"><span class="font12">总大小:'+i.fileLength+"</span></div>";if(f=="blog_pic"||f=="user_header"||f=="background_pic"){g='<div class="uping"><span class="f12">总大小:'+i.fileLength+"</span></div>"}else{if(f=="cpgroup"||f=="guanggaopic"){g="总大小:"+i.fileLength}}c("#"+d).html(g);_showUploadPicData(i,f)}}else{a++;if(a>=15){clearTimeout(b);c("#"+d).html("");alert("上传出错！");_setUploadButton(false)}b=setTimeout(function(){_showUploadStatus(e,d,f)},1000)}}catch(l){clearTimeout(b);alert("上传出错！")}},error:function(g){alert("上传出错！")}})};_setUploadButton=function(d){if(c("input[name='uploadFileSubBtn']").size()!=0){c("input[name='uploadFileSubBtn']").attr("disabled",d)}if(c("#btnSave").size()!=0){c("#btnSave").attr("disabled",d)}};c.mk.upload.setWaterColor=function(d){c("#waterColor").val(d.value)}})(jQuery1);