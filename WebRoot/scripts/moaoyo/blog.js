(function(e){if(typeof e.mk=="undefined"){e.mk={}}if(typeof e.mk.blog=="undefined"){e.mk.blog={}}e.mk.blog.blogAdd=function(p,g,m,h,k,o,l){e.mk.common.clearBlogSearchDiv();var i=e("#"+m);var j=i.val();if(e.trim(j)==""){alert("怎么也要写些东西哟～");i.focus();return false}var f=e.stringUtil.getContentLength(j,true);if(f>parseInt(o)){alert("最多可输入"+o+"个字符!");i.focus();return}e("#p0_uploadServer").val(e("#uploadServerName").val());var n=e("#blogAddBtn");n.attr("disabled",true);i.val(j);e.ajax({url:g,type:"post",data:e("#"+p).serialize(),success:function(q){n.attr("disabled",false);if(l=="@AT"){e.mk.message.result_hand("success","message");return}i.val("");e("#"+h).val("");e("#"+k).val("");_hideBlogTempThumb();e("#blogVideoNo").show();e("#blogVideoYes").hide();e("#textlefts").text(o);var r=e("#userBlogCount");if(r.size()!=0){r.text(parseInt(r.text())+1)}e.mk.message.result_hand("success","message");var s=e(".nMb_2");if(s.size()>0){s.remove()}e("#hid_before").after(q);e.mk.blog.storage.del(a());e(".userFloatLayer").aero()}})};e.mk.blog.chooseBlogVideo=function(f){e("#blogVideo").val(f);e("#blogVideoNo").attr("style","display:none");e("#blogVideoYes").attr("style","display:inline");e.mokoDialog.close()};e.mk.blog.showBlogAddPicPage=function(){e.mk.common.clearBlogSearchDiv();e.mokoDialog({url:"/jsps/blog/BlogAddPicSmallList.jsp",id:"BlogAddPicSmallList",width:610})};e.mk.blog.delBlogPic=function(){e("#p_src").val("");_hideBlogTempThumb()};e.mk.blog.delBlogVideo=function(){e("#blogVideo").val("");e("#blogVideoNo").show();e("#blogVideoYes").hide()};e.mk.blog.delBlogData=function(h,f,g,j,i){e.mk.common.clearBlogSearchDiv();if(!confirm("确定要删除吗？")){return}b(h,f,g,j,i)};e.mk.blog.delBlogPostData=function(){e.mk.common.clearBlogSearchDiv();e.mokoDialog({url:"/jsps/blog/BlogPostDelPage.jsp"})};var c=new Array();e.mk.blog.openPicDiv=function(l,f,g,h){var k=e("#blogItem"+h).offset();var j=k.top+c[h];$win=e(window);var i=$win.scrollTop();e("#"+l).show();e("#"+f).hide();e("#picMidMsg"+h).hide();e("#"+g).show();if(j<i){$win.scrollTop(k.top)}};e.mk.blog.openPicMidDiv=function(j,f,g,h){if(!c[h]){c[h]=parseInt(e("#blogItem"+h).css("height"))}e("#"+f).hide();e("#"+g).hide();var i=new Image();i.onload=function(){e("#picMidWidth_"+h).val(i.width);e("#picMidHeight_"+h).val(i.height);e("#hidPicTag"+h).val("0")};i.src=e("#picMidImg"+h).attr("src");e("#"+j).show();e("#picMidMsg"+h).show();e("#picMidTag_"+h).show()};e.mk.blog.openZhuanFaBlogPage=function(o,p,m,l,r,q,g,k,i,n,h){if(e("#user_level").val()==5){e.mk.blog.applyMPView(1);return}e.mk.common.clearBlogSearchDiv();if(e.mk.blog.checkIsBlack(i)){return}if(k=="T"){alert("此微博已删除，无法转发。");return}var j=e.param({blogType:g,zfCountID:q,zfUserId:i,ycUserId:n,currentUserId:h});var f="/jsps/blog/BlogZhuanFaSmallList.jsp?"+j;e.mokoDialog({url:f,fixed:false,initFn:function(){var t=e("#zf_content");t.focus();var s="";if(g=="F"){s=e("#"+l).html()}else{s=e("#"+l).html();t.text(" //@"+m+":"+jQuery1.replaceAtUrl(e.mk.face.replaceFace(e("#"+r).html())));jQuery1.setTextAreaCursor(t[0],0,0)}e("#zf_blogContent").html(s);e("#nickName").text(p);e("#zfBlogID").val(o);e("#zf_nickName").text(m);t.characterLimit({numTarget:"#zf_textlefts"});t.atWho()}})};e.mk.blog.blogZhuanFaAdd=function(j,h,l,k){e.mk.common.clearBlogSearchDiv();var f=e("#zf_content");var g=e.trim(f.val());if(e("input[name='zfComment']:checkbox:checked").size()>0&&g==""){alert("怎么也要写些东西哟～");f.focus();return}var i=e.stringUtil.getContentLength(g,true);if(i>l){alert("最多可输入"+l+"个字符!");f.focus();return}e("#zfBlogAddBtn").attr("disabled",true);f.val(g);e.ajax({url:h,type:"post",data:e("#"+j).serialize(),success:function(n){if(n=="blogDel"){alert("此微博已删除，无法转发。");e.mokoDialog.close();return}if(n=="dataErr"){alert("数据错误,请刷新页面重新操作！");e.mokoDialog.close();return}e.mokoDialog.close();e.mokoDialog({url:"/jsps/blog/BlogZhuanFaSuccessView.jsp",time:1,esc:false});var m=e("#"+k);m.text(parseInt(m.text())+1);var o=e("#userBlogCount");o.text(parseInt(o.text())+1);e("#hid_before").after(n);e(".userFloatLayer").aero()}})};e.mk.blog.atUserMsg=function(h,f){var g=e("#"+f).val();if(e.mk.blog.checkIsBlack(g)){return}e.mokoDialog({url:"/jsps/blog/BlogAtAddSmallList.jsp",fixed:false,initFn:function(){var j=e("#"+h).val();var i=e("#blogContent");i.focus();i.val("对@"+j+" 说:");e("#atUserID").val(g);var i=e("#blogContent");i.characterLimit({numTarget:"#textlefts"});i.atWho()}})};e.mk.blog.checkIsBlack=function(g){var f=false;e.ajax({url:"/subscribeUpdate|checkIsBlackAjax.action",type:"post",async:false,data:{subscribeId:g},success:function(h){if(h=="black"){f=true;e.mokoDialog({url:"/jsps/blog/BlackTiShiPage.jsp"})}}});return f};e.mk.blog.showCommentTop=function(f,k,g,j,i,m,l){if(e("#user_level").val()==5){e.mk.blog.applyMPView(2);return}var h=e("#"+f);h.toggle();if(e("#"+f+":visible").length<=0){return}e.ajax({url:"/blogShow|showCommentListAjax.action",type:"post",data:{blogID:k,userID:g,ycNickName:m,blogType:l,ycUserId:i},success:function(n){if(n=="dataErr"){alert("数据错误,请刷新页面重新操作！");return}h.html(n);var o=e("#"+k+"replyComments");o.focus();if(parseInt(j)>10){e("#otherCommentDiv"+k).show();e("#otherComment"+k).html(parseInt(j)-10)}o.autoResize();o.characterLimit({substring:true});o.atWho();e(".userFloatLayer").aero()}})};e.mk.blog.huifuComment=function(h,g,f){$blogReplyComments=e("#"+g+"replyComments");$blogReplyComments.focus();$blogReplyComments.val("回复@"+h+":");e("#commentID"+g).val(f)};e.mk.blog.addCommentOrReComment=function(k,f,m,h){if(f==null||f==""){alert("请先登录~");return false}if(e("#"+m).val()=="none"){alert("由于用户设置，你无法进行评论~");return false}$blogReplyComments=e("#"+k+"replyComments");var j=e.trim($blogReplyComments.val());if(j==""){alert("怎么也要写些东西哟~");return false}if(e.stringUtil.getContentLength(j)>140){alert("内容应限制在140个字节内~");return false}$blogReplyComments.val(j);var i=e("#Send"+k);i.hide();e("#replySending"+k).show();var g="/blogUpdate|addBlogCommentAjax.action";var l=e("#commentID"+k);if(l.val()!=0){g="/blogUpdate|addBlogReCommentAjax.action"}e.ajax({url:g,type:"post",data:e("#SendComment"+k).serialize(),success:function(n){if(n=="dataErr"){alert("数据错误,请刷新页面重新操作！");return}var o=e("#commentCount_"+k);o.text(parseInt(o.text())+1);e("#com_ment"+k).after(n);var q=e("input[name='chkAddType']");if(q.size()!=0){q.attr("checked",false);q.val("F")}var p=e("input[name='chkYcAddType']");if(p.size()!=0){p.attr("checked",false);p.val("F")}e("#addReply"+k).hide();$blogReplyComments.val("");if(h=="blogComment"){$blogReplyComments.css({height:"20px"})}l.val("0");i.show();e("#replySending"+k).hide();e(".userFloatLayer").aero()}})};e.mk.blog.changeBlogCommentPage=function(f,g,h){var i={blogID:f,curPage:h,totalRecords:g};d("/blogShow|showBlogCommentAjax.action",i)};e.mk.blog.changeBlogPage=function(f,g,h){var i={showType:f,curPage:h,totalRecords:g};d("/mgrindex|showBlogListAjax.action",i)};e.mk.blog.changeBlogType=function(f,g){if(f=="allblog"){e("#li_all").attr("class","alive");e("#li_all_blog").attr("class","mC bd");e("#li_my").attr("class","");e("#li_my_blog").attr("class","gC1 b")}else{e("#li_all").attr("class","");e("#li_all_blog").attr("class","gC1 b");e("#li_my").attr("class","alive");e("#li_my_blog").attr("class","mC bd")}e.mk.blog.changeBlogPage(f,g,1)};e.mk.blog.applyMPView=function(g){var f=e.param({showType:g});e.mokoDialog({url:"/jsps/blog/BlogApplyMPView.jsp?"+f})};e.mk.blog.saveBlogContent=function(f){if(f=="分享图片"){return false}e.mk.blog.storage.set(a(),f)};e.mk.blog.showBlogPic=function(f){var g=f.pic[0].picName;e("#p_src").val(g);var h=new Array();h.push(g);_blogPicPrepare(h)};_blogPicPrepare=function(g){var f=e.param({"p[0].uploadType":"blog_pic","p[0].src":g,"p[0].uploadServer":e("#uploadServerName").val()},true);e.ajax({type:"POST",url:"/uploadPre|blogPic_prepare.action",data:f,dataType:"json",success:function(h){if(h.code!="1"){alert("图片上传出错!");return}_showBlogTempThumb(h)}})};_showBlogTempThumb=function(h){var f=e("#blogContent");if(f.val()==""){f.val("分享图片");textArea=f[0];end=textArea.value.length;textArea.focus();if(textArea.createTextRange){var i=textArea.createTextRange();i.move("character",end);i.select()}else{textArea.setSelectionRange(end,end)}}var j=e("#picUp1").val().split("\\").pop();var m=j.lastIndexOf(".");var g=j.substring(0,m);var k=j.substring(m,j.length);if(g.length>20){g=g.substring(0,20)+"…"}e("#blog_temp_thumb_name").text(g+k);e("#blog_temp_thumb_img").prop("src",e("#webServerName").val()+h.thumb);e("#blogPicNo").hide();e("#blogPicYes").show();var l=e("#blogPicYes").position();e("#blog_temp_thumb").css({left:l.left+"px",top:(l.top+15)+"px"}).show();e.mk.upload.cancelUpload("BlogAddPicSmallList")};_hideBlogTempThumb=function(){e("#blogPicYes").hide();var f=e("#blogContent");if(f.val()=="分享图片"){f.val("");f.focus()}e("#blog_temp_thumb_name").empty();e("#blog_temp_thumb_img").prop("src","");e("#blog_temp_thumb").hide();e("#blogPicNo").show()};e.mk.blog.storage=function(g,l){var i=true,m=g.localStorage,h="localstorage",f,n=function(){return i},k=function(){throw new Error("don't support localStorage")};if(jQuery1.isIE){m=l.documentElement;try{m.addBehavior("#default#userdata");m.save(h)}catch(j){i=false}if(i){f={set:function(o,p){m.setAttribute(o,p);m.save(h)},get:function(o){m.load(h);return m.getAttribute(o)},del:function(o){m.removeAttribute(o);m.save(h)}}}}else{f={set:function(o,p){return m.setItem(o,p)},get:function(o){return m.getItem(o)},del:function(o){return m.removeItem(o)}}}if(!f){f={set:k,get:k,del:k}}f.support=n;return f}(window,document);var d=function(f,h){var g=e("#loading");g.show();e("#ajaxMessage").load(f,h,function(){e(".userFloatLayer").aero();e(window).scrollTop(0);g.hide()})},b=function(h,f,g,j,i){e.ajax({url:"/blogUpdate|delBlog.action",type:"post",data:"blogID="+h,success:function(k){if(k=="dataErr"){alert("操作错误！");return}if(g=="blogDetail"){e.location(i+"/"+j+"/index.html")}else{e("#"+f).remove();e("#"+h+"CommentTop6").remove();var l=e("#userBlogCount");l.text(parseInt(l.text())-1)}}})},a=function(){return"blogContent_"+e("#userId").val()};jQuery1.fn.rotate=function(o,j,h){var g=this.get(0);if(!h){g.angle=((g.angle==undefined?0:g.angle)+j)%360}else{g.angle=j}if(g.angle>=0){var n=Math.PI*g.angle/180}else{var n=Math.PI*(360+g.angle)/180}var m=Math.cos(n);var k=Math.sin(n);if(document.all&&!window.opera){var i=document.createElement("img");i.src=g.src;i.height=g.height;i.width=g.width;var l=1;if(o>1){i.height=jQuery1("#picMidHeight_"+o).val();i.width=jQuery1("#picMidWidth_"+o).val();l=420/i.width}else{if(g.height>420){l=420/g.height}}i.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+(m*l)+",M12="+(-k*l)+",M21="+(k*l)+",M22="+(m*l)+",SizingMethod='auto expand')"}else{var i=document.createElement("canvas");if(!g.oImage){i.oImage=new Image();i.oImage.src=g.src}else{i.oImage=g.oImage}i.style.width=i.width=Math.abs(m*i.oImage.width)+Math.abs(k*i.oImage.height);i.style.height=i.height=Math.abs(m*i.oImage.height)+Math.abs(k*i.oImage.width);if(g.height>=440){i.style.width="420px"}var f=i.getContext("2d");f.save();if(n<=Math.PI/2){f.translate(k*i.oImage.height,0)}else{if(n<=Math.PI){f.translate(i.width,-m*i.oImage.height)}else{if(n<=1.5*Math.PI){f.translate(-m*i.oImage.width,i.height)}else{f.translate(0,-k*i.oImage.width)}}}f.rotate(n);f.drawImage(i.oImage,0,0,i.oImage.width,i.oImage.height);f.restore()}i.id=g.id;i.angle=g.angle;g.parentNode.replaceChild(i,g)};jQuery1.fn.rotateRight=function(f,g){this.rotate(f==undefined?0:f,g==undefined?90:g)};jQuery1.fn.rotateLeft=function(f,g){this.rotate(f==undefined?0:f,g==undefined?-90:-g)};e.mk.blog.picMove=function(g,h){if(document.all&&!window.opera){var i=e("#picMidHeight_"+g).val();var f=parseInt(e("#hidPicTag"+g).val());if(h=="left"){f=f-90;if(i>420&&(f==0||f==-180||f==-360)){e("#picMidImg"+g).rotateLeft(g)}else{e("#picMidImg"+g).rotateLeft(0)}if(f==-360){f=0}}else{f=f+90;if(i>420&&(f==0||f==180||f==360)){e("#picMidImg"+g).rotateRight(g)}else{e("#picMidImg"+g).rotateRight(0)}if(f==360){f=0}}e("#hidPicTag"+g).val(f)}else{if(h=="left"){e("#picMidImg"+g).rotateLeft(0)}else{e("#picMidImg"+g).rotateRight(0)}}}})(jQuery1);jQuery1(function(){var b=jQuery1("#blogContent");b.characterLimit({numTarget:"#textlefts"});b.atWho();var a="blogContent_"+jQuery1("#userId").val();var e=jQuery1.mk.blog.storage.get(a);if(e){b.val(e).focus()}var c=jQuery1("#blogCommentContent");c.characterLimit({substring:true});c.atWho();var d=jQuery1("textarea[id$=replyComments]");d.characterLimit({substring:true});d.autoResize();d.atWho();jQuery1(".userFloatLayer").aero()});